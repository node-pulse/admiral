# Caddy Configuration for Local Development
# No HTTPS, simple HTTP routing

# Global options for development
{
    # Disable automatic HTTPS for local development
    auto_https off

    # Enable debug logging
    debug
}

# ------------------------------------------------------------
# Admin Dashboard (Flagship - Laravel)
# ------------------------------------------------------------
:8000 {
    # Proxy to Laravel's built-in development server
    reverse_proxy flagship:9000 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }

    # Enable gzip compression
    encode gzip

    # Verbose logging for development
    log {
        output stdout
        format console
        level DEBUG
    }
}

# ------------------------------------------------------------
# Metrics Ingestion (Submarines Ingest)
# ------------------------------------------------------------
localhost:8080 {
    reverse_proxy submarines-ingest:8080 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
    }

    log {
        output stdout
        format console
    }
}

# ------------------------------------------------------------
# Status Pages (Submarines Status)
# ------------------------------------------------------------
localhost:8082 {
    reverse_proxy submarines-status:8082 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
    }

    log {
        output stdout
        format console
    }
}

# ------------------------------------------------------------
# Vite Dev Server (Hot Module Replacement)
# ------------------------------------------------------------
localhost:5173 {
    reverse_proxy flagship:5173 {
        header_up Host {host}
        header_up Upgrade {http.request.header.Upgrade}
        header_up Connection {http.request.header.Connection}
    }

    log {
        output stdout
        format console
    }
}
