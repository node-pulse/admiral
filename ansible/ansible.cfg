[defaults]
# Roles (supports both deployer and flagship container paths)
roles_path = /app/ansible/roles:/var/www/html/ansible/roles

# Inventory
inventory = ./inventory/dynamic.php
inventory_cache = True
inventory_cache_timeout = 300

# Performance
# Parallel execution (max 100 servers at once)
forks = 100
# Disable strict host key checking
host_key_checking = False
# SSH connection timeout
timeout = 30
# Smart fact gathering
gathering = smart
# Cache facts to JSON files
fact_caching = jsonfile
fact_caching_connection = /tmp/ansible_fact_cache
fact_caching_timeout = 86400

# SSH Configuration
# Default SSH user (can be overridden per host)
remote_user = root
transport = ssh

# Callbacks
# Better output formatting
stdout_callback = default
result_format = yaml
callbacks_enabled = profile_tasks, timer

# Logging
log_path = /var/log/ansible/ansible.log

# Retry Files
retry_files_enabled = True
retry_files_save_path = /tmp/ansible-retry

# Privilege Escalation
become = True
become_method = sudo
become_user = root
become_ask_pass = False

# Error Handling
# Continue on errors
any_errors_fatal = False
# Fail if more than 10% of hosts fail
max_fail_percentage = 10

[ssh_connection]
ssh_args = -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no
# Faster execution
pipelining = True
control_path = /tmp/ansible-ssh-%%h-%%p-%%r
